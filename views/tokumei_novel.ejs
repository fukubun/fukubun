<main class="pl-16 max-w-3xl mx-auto p-0 flex-1 min-w-0">

<ul class="flex flex-wrap text-sm font-medium text-center text-body">
       
 <li class="me-2">
            <a href="tokumei"
   class="inline-flex items-center gap-1 justify-center p-4 border-b border-transparent rounded-t-base hover:text-fg-brand hover:border-brand group">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-newspaper-icon lucide-newspaper"><path d="M15 18h-5"/><path d="M18 14h-8"/><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-4 0v-9a2 2 0 0 1 2-2h2"/><rect width="8" height="4" x="10" y="6" rx="1"/></svg>

                ブログ
            </a>
        </li>

<li class="me-2">
  <a href="tokumei_novel"
     class="inline-flex items-center gap-1 justify-center p-4 rounded-t-base
            <%= page === 'novel'
                ? 'border-b-2 border-brand text-fg-brand'
                : 'border-b-2 border-transparent hover:text-fg-brand hover:border-brand' %>">
                
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open-icon lucide-book-open">
      <path d="M12 7v14"/>
      <path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/>
    </svg>

    小説
  </a>
</li>

        <li class="me-2">
            <a href="tokumei_save"
   class="inline-flex items-center gap-1 justify-center p-4 border-b border-transparent rounded-t-base hover:text-fg-brand hover:border-brand group">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark-icon lucide-bookmark"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>
                後で見る
            </a>
        </li>
        
        <li class="me-2">
  <a href="tokumei_log"
   class="inline-flex items-center gap-1 justify-center p-4 border-b border-transparent rounded-t-base hover:text-fg-brand hover:border-brand group">

    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history-icon lucide-history"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>

    閲覧履歴
  </a>
</li>


 <li class="me-2">
 <a href="tokumei_review"
   class="inline-flex items-center gap-1 justify-center p-4 border-b border-transparent rounded-t-base hover:text-fg-brand hover:border-brand group">

                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star-icon lucide-star"><path d="M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z"/></svg>

                評価済み
            </a>

        </li>
    </ul>
</div>


  <ol class="timeline space-y-6">

    <% if (novels && novels.length) { %>
      <% novels.forEach(novel => { %>

        <li class="timeline-item border-b border-gray-200 dark:border-gray-700 pb-4 last:pb-0 last:border-b-0">

          <div class="card relative p-3 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800">

            <!-- 全体リンク -->
            <a href="/tokumei_novel/<%= novel.id %>"
               class="stretched-link absolute inset-0 z-0"
               aria-label="投稿を開く: <%= novel.title || '（無題）' %>"></a>

            <!-- 投稿日時 -->
<time class="mb-1 text-sm text-gray-500 dark:text-gray-400"><%= novel.time %></time>

            <!-- タイトル -->
            <h3 class="text-lg font-medium text-gray-900 dark:text-white mt-1">
              <a href="/tokumei_novel/<%= novel.id %>" class="inline-block z-10 relative">
                <%= novel.title || "（無題）" %>
              </a>
            </h3>

            <!-- ボタン類 -->
            <div class="mt-2 z-10 relative">

              <!-- 後で読む（必要なら） -->
              <form action="/tokumei_save" method="POST" class="inline" onsubmit="event.stopPropagation();">
                <input type="hidden" name="postId" value="<%= novel.id %>">
                <button type="submit"
                        class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700"
                        onclick="event.stopPropagation();">
                  後で読む
                </button>
              </form>

              <% if (novel.deletable) { %>

                <!-- 削除ボタン -->
                <button
                  type="button"
                  data-modal-target="deleteModal-<%= novel.id %>"
                  data-modal-toggle="deleteModal-<%= novel.id %>"
                  class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-red-600 bg-red-50 rounded-md hover:bg-red-100 dark:bg-transparent dark:text-red-400 dark:hover:bg-gray-800 ml-2"
                  onclick="event.stopPropagation();">
                  削除
                </button>

              <% } %>

            </div>
          </div>

          <% if (novel.deletable) { %>

            <!-- 削除モーダル -->
            <div id="deleteModal-<%= novel.id %>" tabindex="-1" aria-hidden="true"
                 class="hidden overflow-y-auto overflow-x-hidden fixed inset-0 z-50 flex items-center justify-center
                        w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">

              <div class="relative p-4 w-full max-w-md max-h-full">
                <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">

                  <div class="flex items-center justify-between p-4 md:p-5 rounded-t">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                      小説を削除しますか？
                    </h3>
                    <button type="button"
                            class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg
                                   text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600
                                   dark:hover:text-white"
                            data-modal-hide="deleteModal-<%= novel.id %>">
                      ✕
                    </button>
                  </div>

                  <div class="p-4 md:p-5 space-y-4">
                    <p class="text-base leading-relaxed text-gray-500 dark:text-gray-400">
                      この操作は取り消せません。
                    </p>
                  </div>

                  <div class="flex items-center justify-end p-4 md:p-5 rounded-b gap-3">

                    <form action="/tokumei_novel/delete" method="POST" class="delete-form m-0">
                      <input type="hidden" name="postId" value="<%= novel.id %>">
                      <button type="submit" class="hover:text-red-500 transition-colors px-4 py-2">
                        削除する
                      </button>
                    </form>

                    <button type="button"
                            class="ms-3 text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none
                                   focus:ring-blue-300 rounded-lg border border-gray-300 text-sm font-medium
                                   px-5 py-2.5 hover:text-gray-900 dark:bg-gray-700 dark:text-gray-300
                                   dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600
                                   dark:focus:ring-gray-600"
                            data-modal-hide="deleteModal-<%= novel.id %>">
                      キャンセル
                    </button>

                  </div>

                </div>
              </div>
            </div>

          <% } %>

        </li>

      <% }) %>
    <% } else { %>

      <li class="mb-10">
        <p class="text-gray-500">小説がありません。</p>
      </li>

    <% } %>

  </ol>

<script>
  // モーダルの開閉をハンドルする簡易スクリプト
  (function() {
    function showModal(id) {
      var el = document.getElementById(id);
      if (!el) return;
      el.classList.remove('hidden');
      // optional: prevent background scroll
      document.documentElement.style.overflow = 'hidden';
    }
    function hideModal(id) {
      var el = document.getElementById(id);
      if (!el) return;
      el.classList.add('hidden');
      document.documentElement.style.overflow = '';
    }

    // data-modal-show 属性のボタンを監視
    document.querySelectorAll('[data-modal-show]').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.stopPropagation();
        var id = btn.getAttribute('data-modal-show');
        showModal(id);
      });
    });

    // data-modal-hide 属性の要素（閉じるボタンやキャンセル）を監視
    document.querySelectorAll('[data-modal-hide]').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.stopPropagation();
        var id = btn.getAttribute('data-modal-hide');
        hideModal(id);
      });
    });

    // モーダルの背景クリックで閉じる（モーダル本体の外側クリック）
    document.addEventListener('click', function(e) {
      // モーダル要素を列挙して、クリックがモーダル外なら閉じる
      document.querySelectorAll('[id^="deleteModal-"]').forEach(function(modal) {
        if (modal.classList.contains('hidden')) return;
        if (!modal.contains(e.target)) {
          // クリックがモーダル外なら閉じる
          modal.classList.add('hidden');
          document.documentElement.style.overflow = '';
        }
      });
    });

    // Esc キーで閉じる
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.querySelectorAll('[id^="deleteModal-"]').forEach(function(modal) {
          if (!modal.classList.contains('hidden')) {
            modal.classList.add('hidden');
            document.documentElement.style.overflow = '';
          }
        });
      }
    });

    // モーダル内のフォーム送信時は propagation を止めて通常 submit させる
    document.addEventListener('submit', function(e) {
      if (e.target && e.target.classList.contains('delete-form')) {
        e.stopPropagation();
        // フォームは通常送信（POST）されるのでここで何もしない
      }
    }, true);
  })();
</script>



<!-- スピードダイヤル -->
<div data-dial-init class="fixed end-6 bottom-6 group z-50">

  <!-- 開いたときのメニュー -->
  <div id="speed-dial-menu-default" class="flex flex-col items-center hidden mb-4 space-y-3">

    <!-- ブログ投稿 -->
    <a href="/tokumei_post"
       class="flex justify-center items-center w-[52px] h-[52px] bg-gray-100 text-gray-700 rounded-full border border-gray-300 shadow hover:bg-gray-200">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-newspaper-icon lucide-newspaper"><path d="M15 18h-5"/><path d="M18 14h-8"/><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-4 0v-9a2 2 0 0 1 2-2h2"/><rect width="8" height="4" x="10" y="6" rx="1"/></svg>
    </a>

    <!-- 小説投稿 -->
    <a href="/tokumei_novel_post"
       class="flex justify-center items-center w-[52px] h-[52px] bg-gray-100 text-gray-700 rounded-full border border-gray-300 shadow hover:bg-gray-200">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open-icon lucide-book-open"><path d="M12 7v14"/><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"/></svg>
    </a>

  </div>

  <!-- メインボタン（開閉） -->
  <button type="button"
          data-dial-toggle="speed-dial-menu-default"
          aria-controls="speed-dial-menu-default"
          aria-expanded="false"
          class="flex items-center justify-center text-white bg-blue-600 rounded-full w-14 h-14 hover:bg-blue-700 shadow-lg">
    <svg class="w-6 h-6 transition-transform group-hover:rotate-45" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M5 12h14m-7 7V5"/>
    </svg>
  </button>

</div>






<!-- 左固定サイドバー -->
<aside class="fixed top-0 left-0 z-40 w-48 h-screen bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700">
  <div class="h-full flex flex-col items-start py-4 px-4">

    <!-- ホーム -->
    <a href="/timeline" class="mb-6 flex items-center gap-3 text-gray-700 hover:text-blue-500">
      <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"/>
        <path d="M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
      </svg>
      <span class="text-base font-medium">ホーム</span>
    </a>

    <!-- プロフィール -->
    <a href="/profile" class="mb-6 flex items-center gap-3 text-gray-700 hover:text-blue-500">
      <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M2 21a8 8 0 0 1 10.821-7.487"/>
        <path d="M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"/>
        <circle cx="10" cy="8" r="5"/>
      </svg>
      <span class="text-base font-medium">プロフィール</span>
    </a>

    <!-- 匿名 -->
    <a href="/tokumei" class="mb-6 flex items-center gap-3 text-gray-700 hover:text-blue-500">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M2 6h4"/><path d="M2 10h4"/><path d="M2 14h4"/><path d="M2 18h4"/>
        <rect width="16" height="20" x="4" y="2" rx="2"/>
        <path d="M9.5 8h5"/><path d="M9.5 12H16"/><path d="M9.5 16H14"/>
      </svg>
      <span class="text-base font-medium">匿名投稿</span>
    </a>

    <!-- 質問 -->
    <a href="/question" class="mb-6 flex items-center gap-3 text-gray-700 hover:text-blue-500">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M6 8.5a6.5 6.5 0 1 1 13 0c0 6-6 6-6 10a3.5 3.5 0 1 1-7 0"/>
        <path d="M15 8.5a2.5 2.5 0 0 0-5 0v1a2 2 0 1 1 0 4"/>
      </svg>
      <span class="text-base font-medium">質問</span>
    </a>

    <!-- 読書 -->
    <a href="/reads" class="mb-6 flex items-center gap-3 text-gray-700 hover:text-blue-500">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect width="8" height="18" x="3" y="3" rx="1"/>
        <path d="M7 3v18"/>
        <path d="M20.4 18.9c.2.5-.1 1.1-.6 1.3l-1.9.7c-.5.2-1.1-.1-1.3-.6L11.1 5.1c-.2-.5.1-1.1.6-1.3l1.9-.7c.5-.2 1.1.1 1.3.6Z"/>
      </svg>
      <span class="text-base font-medium">読書</span>
    </a>

    <!-- 日記 -->
    <a href="/diary" class="mb-6 flex items-center gap-3 text-gray-700 hover:text-blue-500">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M13 21h8"/><path d="m15 5 4 4"/>
        <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/>
      </svg>
      <span class="text-base font-medium">日記</span>
    </a>

    <!-- ログアウト -->
    <a href="/home" class="mb-6 flex items-center gap-3 text-gray-700 hover:text-blue-500">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="m16 17 5-5-5-5"/><path d="M21 12H9"/><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
      </svg>
      <span class="text-base font-medium">ログアウト</span>
    </a>

    <!-- ユーザー -->
    <div class="mt-auto mb-4 flex items-center gap-3">
      <img src="<%= user.icon %>" class="w-9 h-9 rounded-full object-cover">
      <span class="text-base font-medium"><%= user.username %></span>
    </div>

  </div>
</aside>
