<main class="pl-0 sm:pl-16 max-w-3xl mx-auto p-0 flex-1 min-w-0 px-4">

  <!-- ヘッダー -->
  <div class="flex items-center gap-3 mb-6">
    <a href="/tokumei" class="text-2xl leading-none">✕</a>
    <h1 class="text-xl font-semibold text-gray-900">新規投稿</h1>
  </div>

  <!-- 投稿フォーム -->
  <form action="/tokumei_post" method="POST" enctype="multipart/form-data" class="space-y-4">

    <!-- 投稿元をサーバーに伝える -->
    <input type="hidden" name="redirect" value="<%= from %>">

    <!-- アバター + エディタ -->
    <div class="flex gap-3">

      <!-- アバター -->
      <img src="<%= user && user.icon ? user.icon : '/default-avatar.png' %>"
           class="w-10 h-10 rounded-full"
           alt="avatar">

      <!-- エディタ全体 -->
      <div class="w-full mb-4 border border-default-medium rounded-base bg-neutral-secondary-medium shadow-xs">

        <!-- エディタ上部のボタン群 -->
        <div class="flex items-center justify-between px-3 py-2 border-b border-default-medium">

          <div class="flex flex-wrap items-center divide-default-medium sm:divide-x sm:rtl:divide-x-reverse">

            <!-- 左側のアイコン群 -->
            <div class="flex items-center space-x-1 rtl:space-x-reverse sm:pe-4">

  <!-- Attach file -->
  <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M7 8v8a5 5 0 1 0 10 0V6.5a3.5 3.5 0 1 0-7 0V15a2 2 0 0 0 4 0V8" />
    </svg>
    <span class="sr-only">Attach file</span>
  </button>

  <!-- Embed map -->
  <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M17.8 13.938h-.011a7 7 0 1 0-11.464.144h-.016l.14.171c.1.127.2.251.3.371L12 21l5.13-6.248c.194-.209.374-.429.54-.659l.13-.155Z" />
    </svg>
    <span class="sr-only">Embed map</span>
  </button>

  <!-- Upload image -->
  <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path fill="currentColor"
        d="M16 18H8l2.5-6 2 4 1.5-2 2 4Zm-1-8.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z" />
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M10 3v4a1 1 0 0 1-1 1H5m14-4v16a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7.914a1 1 0 0 1 .293-.707l3.914-3.914A1 1 0 0 1 9.914 3H18a1 1 0 0 1 1 1ZM8 18h8l-2-4-1.5 2-2-4L8 18Zm7-8.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z" />
    </svg>
    <span class="sr-only">Upload image</span>
  </button>

  <!-- Format code -->
  <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M10 3v4a1 1 0 0 1-1 1H5m5 4-2 2 2 2m4-4 2 2-2 2m5-12v16a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V7.914a1 1 0 0 1 .293-.707l3.914-3.914A1 1 0 0 1 9.914 3H18a1 1 0 0 1 1 1Z" />
    </svg>
    <span class="sr-only">Format code</span>
  </button>

  <!-- Emoji -->
  <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M15 9h.01M8.99 9H9m12 3a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM6.6 13a5.5 5.5 0 0 0 10.81 0H6.6Z" />
    </svg>
    <span class="sr-only">Add emoji</span>
  </button>

</div>

            <!-- 右側のアイコン群 -->
            <div class="flex flex-wrap items-center space-x-1 rtl:space-x-reverse sm:ps-4">

  <!-- Add list -->
  <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 6h8m-8 6h8m-8 6h8M4 16a2 2 0 1 1 3.321 1.5L4 20h5M4 5l2-1v6m-2 0h4"/>
    </svg>
    <span class="sr-only">Add list</span>
  </button>

  <!-- Settings -->
  <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M21 13v-2a1 1 0 0 0-1-1h-.757l-.707-1.707.535-.536a1 1 0 0 0 0-1.414l-1.414-1.414a1 1 0 0 0-1.414 0l-.536.535L14 4.757V4a1 1 0 0 0-1-1h-2a1 1 0 0 0-1 1v.757l-1.707.707-.536-.535a1 1 0 0 0-1.414 0L4.929 6.343a1 1 0 0 0 0 1.414l.536.536L4.757 10H4a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h.757l.707 1.707-.535.536a1 1 0 0 0 0 1.414l1.414 1.414a1 1 0 0 0 1.414 0l.536-.535 1.707.707V20a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-.757l1.707-.708.536.536a1 1 0 0 0 1.414 0l1.414-1.414a1 1 0 0 0 0-1.414l-.535-.536.707-1.707H20a1 1 0 0 0 1-1Z"/>
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/>
    </svg>
    <span class="sr-only">Settings</span>
  </button>

  <!-- Timeline -->
  <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="m11.5 11.5 2.071 1.994M4 10h5m11 0h-1.5M12 7V4M7 7V4m10 3V4m-7 13H8v-2l5.227-5.292a1.46 1.46 0 0 1 2.065 2.065L10 17Zm-5 3h14a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1Z"/>
    </svg>
    <span class="sr-only">Timeline</span>
  </button>

  <!-- Download -->
  <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
    <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 13V4M7 14H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1h-2m-1-5-4 5-4-5m9 8h.01"/>
    </svg>
    <span class="sr-only">Download</span>
  </button>

</div>

          </div>

          <!-- フルスクリーン -->
          <button type="button" class="p-2 text-body rounded-sm cursor-pointer hover:text-heading hover:bg-neutral-tertiary-medium">
  <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
      d="M8 4H4m0 0v4m0-4 5 5m7-5h4m0 0v4m0-4-5 5M8 20H4m0 0v-4m0 4 5-5m7 5h4m0 0v-4m0 4-5-5"/>
  </svg>
  <span class="sr-only">Full screen</span>
</button>

        </div>

<!-- タイトル入力欄（エディタ内部） -->
  <div class="px-4 pt-3 pb-2 border-b border-default-medium">
    <input type="text" name="title"
      class="w-full px-0 py-2 text-lg font-semibold bg-neutral-secondary-medium border-0 focus:ring-0 placeholder:text-body"
      placeholder="タイトルを入力">
  </div>

        <!-- テキストエリア -->
        <div class="px-4 py-2 bg-neutral-secondary-medium rounded-b-base">
          <label for="editor" class="sr-only">Publish post</label>
          <textarea id="editor" name="message" rows="8"
                    class="block w-full px-0 text-sm text-heading bg-neutral-secondary-medium border-0 focus:ring-0 placeholder:text-body"
                    placeholder="記事を書く" required></textarea>
        </div>

      </div>
    </div>

    <!-- 投稿ボタン -->
    <div class="flex justify-end">
      <button type="submit"
        class="px-5 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-300">
        投稿する
      </button>

    </div>

  </form>

</main>

<!-- プレビュー JS -->
<script>
  const input = document.getElementById('imageInput');
  const preview = document.getElementById('imagePreview');
  const wrapper = document.getElementById('imagePreviewWrapper');
  const clearBtn = document.getElementById('clearImageBtn');

  input.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) {
      wrapper.classList.add('hidden');
      preview.src = "";
      return;
    }

    const url = URL.createObjectURL(file);
    preview.src = url;
    wrapper.classList.remove('hidden');
  });

  clearBtn.addEventListener('click', () => {
    input.value = "";
    preview.src = "";
    wrapper.classList.add('hidden');
  });
</script>